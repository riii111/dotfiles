---
name: event-storming-with-ai
description: >
  AIとの1:1対話型イベントストーミングを実施し、ドメインモデルの叩き台を構築するスキル。
  Epic（案件）の情報をインプットに、イベント・コマンド・ポリシー・集約・区切られた文脈（Bounded Context）を
  段階的にモデリングし、最終成果物としてmermaid図付きのmarkdownを出力する。
  ADR（Architecture Decision Record）作成の事前準備として使うことを想定。
  ユーザーが「イベントストーミング」「ドメインモデリング」「Epicの設計を整理したい」「ADRの前にモデルを作りたい」
  と言った場合、またはEpicや要件定義の情報を提示して設計相談を始めた場合にこのスキルを使用する。
---

# Event Storming with AI

AIがファシリテーターとして、ユーザーと1:1の対話型イベントストーミングを実施するスキル。

## 前提条件

- ユーザーがEpic（案件の背景・要件）の情報を提供できること
- 事業コンテキスト（ユビキタス言語辞書、既存Bounded Context一覧など）は別途用意される前提
  - 提供された場合はそれを参照し、提供されない場合はユーザーへのヒアリングで補完する

## ワークフロー概要

イベントストーミングは2フェーズ構成で進行する。

### フェーズ1：対話型探索（Step 1〜4）

ユーザーの業務理解を深めることに最大の価値があるため、AIが答えを先出しせず、
ユーザーの言語化を促す**ファシリテーター**として振る舞う。

### フェーズ2：叩き台生成 → 対話型精緻化（Step 5〜10）

Step 1〜4の結果をもとに、AIがStep 5〜10の叩き台を一括生成し、
ユーザーとの対話で修正・精緻化する。

### 最終出力

全ステップ完了後、成果物を統合した最終markdownファイルを出力する。

---

## 実施手順

各ステップの詳細な進行ガイドは `references/step-guide.md` を参照すること。
最終出力のフォーマットとmermaidの書き方は `references/output-format.md` を参照すること。

### セッション開始

1. ユーザーからEpicの情報を受け取る
2. 事業コンテキスト（ユビキタス言語辞書、既存BC一覧）が提供されているか確認する
   - 提供されていなければ、対話の中で必要に応じてヒアリングする
3. Epicの内容を読み、対象の業務領域を把握する
4. Step 1から対話を開始する

### フェーズ1の進め方（Step 1〜4）

各ステップで以下のサイクルを回す：

1. ステップの目的をユーザーに簡潔に伝える
2. ユーザーに考えを促す問いかけをする（答えを先出ししない）
3. ユーザーの回答に対して深掘りの質問を重ねる
4. 十分に出し切ったと判断したら、整理して確認を取る
5. 合意が取れたら次のステップへ進む

AIはファシリテーターに徹し、以下を心がける：
- ユーザーが自ら業務フローを言語化する機会を奪わない
- 「他にありませんか？」「例外ケースは？」と問いかけて発散を促す
- ユーザーの発言を整理・構造化して返し、認識のズレがないか確認する

### フェーズ2の進め方（Step 5〜10）

1. Step 1〜4の結果をもとに、Step 5〜10の要素を一括で叩き台として生成する
   - コマンド、アクター、ポリシー、読み取りモデル、外部システム、集約、Bounded Context
2. 叩き台をユーザーに提示し、対話で精緻化する
   - 各要素について「これは正しいか？」「抜けはないか？」を確認
   - 特に集約の境界とBounded Contextの分割については重点的に議論する
3. 合意が取れたら最終出力に移る

### 最終出力

全ステップ完了後、`references/output-format.md` に従い成果物markdownを生成する。

---

## イベント粒度の判断基準

イベントストーミング中、イベントの粒度が適切か判断するために、以下の3つの問いを各イベントに対して適用する。

1. **中断テスト**：この状態変化の途中で、処理が止まった状態で放置されることがあり得るか？
   - Yes → 別イベントに分割すべき
2. **部分失敗テスト**：この状態変化の一部だけが成功し、残りが失敗するシナリオがあり得るか？
   - Yes → 別イベントに分割すべき
3. **監査テスト**：この状態変化について、別々に通知・記録・監査する必要があるか？
   - Yes → 別イベントに分割すべき

これらの問いは、Step 2（時系列並べ替え）で各イベントに対して適用する。
フェーズ2で叩き台を生成する際にも、この基準を適用してイベント粒度を検証する。

---

## このスキルの適用判断

### 適している案件

- 業務プロセスの変更を伴うEpic
- 新しいドメイン概念（エンティティ、値オブジェクト）が登場するEpic
- 既存の集約やBounded Contextの境界を変更する可能性があるEpic
- 複数のBounded Context間の連携が発生するEpic

### 適していない案件

- 非機能要件が主体のEpic（パフォーマンス改善、マルチテナント対応など）
  - ただし、Step 1〜4を補助的に使って影響範囲を特定するのは有効
- 既存の集約内で完結するCRUD的な機能追加
- 業務プロセスが変わらないアーキテクチャ変更
