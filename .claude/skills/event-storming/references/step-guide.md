# Step-by-Step Guide

イベントストーミングの各ステップにおけるAIファシリテーターの進行ガイド。

---

## フェーズ1：対話型探索（Step 1〜4）

ユーザー自身の言語化と業務理解の深化に最大の価値がある。
AIは答えを先出しせず、問いかけでユーザーの思考を引き出す。

### Step 1：業務イベントの洗い出し

**目的**：業務領域で発生するイベントを網羅的に洗い出す。

**進め方**：

1. ユーザーに「このEpicで扱う業務で、どんな出来事（状態変化）が起きますか？」と問いかける
2. ユーザーが挙げたイベントを受け止めつつ、以下の観点で深掘りする：
   - 「そのイベントの前に、何が起きていますか？」
   - 「そのイベントの後に、何が起きますか？」
   - 「うまくいかなかったケース（エラー、差し戻し）はありますか？」
   - 「他に関係者が知っておくべき出来事はありますか？」
3. 出し切ったと感じたら、ユーザーに確認する

**イベントの記述ルール**：
- 過去形で記述する（例：「契約が締結された」「請求書が発行された」）
- 1つのイベントには1つの状態変化だけを含める

**粒度チェック**：
各イベントに対して以下の3つの問いを適用する。いずれかにYesなら分割を検討する。
- 中断テスト：途中で処理が止まった状態で放置されることがあり得るか？
- 部分失敗テスト：一部だけが成功し残りが失敗するシナリオがあり得るか？
- 監査テスト：別々に通知・記録・監査する必要があるか？

### Step 2：時系列の並べ替え

**目的**：イベントを時系列に整理し、業務フローの全体像を把握する。

**進め方**：

1. Step 1で出たイベントを時系列順に並べた一覧を提示する
2. ユーザーに「この順番で正しいですか？」と確認する
3. 並べ替えながら以下を確認する：
   - 「このイベントとこのイベントの間に、抜けている出来事はありませんか？」
   - 「正常系の流れはこれで合っていますか？」
4. 正常系が確定したら、例外・エラー系のイベントを追加する
   - 「この処理が失敗したらどうなりますか？」
   - 「差し戻しや取り消しのケースはありますか？」

**粒度の最終確認**：
並べ替え完了後、全イベントに対して粒度チェック（3つの問い）を改めて確認する。

### Step 3：問題点（ペインポイント）の特定

**目的**：業務プロセスのボトルネックや知識不足を可視化する。

**進め方**：

1. 時系列に並んだイベントフローを見ながら問いかける：
   - 「ここまでの流れで、特に厄介な箇所や悩ましい箇所はありますか？」
   - 「業務ルールが曖昧な箇所、人によって理解が異なりそうな箇所はどこですか？」
   - 「現行システムで非効率だと感じている箇所はありますか？」
2. ペインポイントは以下の3種類に分類する：
   - **知識のギャップ**：業務ルールを正確に把握していない箇所
   - **プロセスのボトルネック**：手作業や遅延が発生する箇所
   - **矛盾する認識**：関係者間で見解が割れそうな箇所

### Step 4：転換イベントと境界の特定

**目的**：文脈やフェーズが大きく切り替わるポイントを見つけ、Bounded Contextの候補を特定する。

**進め方**：

1. イベントフローの中で「ここから先は別の業務」と感じるポイントを問いかける：
   - 「この流れの中で、担当者や部署が変わるポイントはどこですか？」
   - 「ここから先は別のシステムや別のチームが担当する、という境界はありますか？」
   - 「同じ言葉が違う意味で使われるポイントはありますか？」
2. 境界候補を明示し、ユーザーの合意を得る

**フェーズ1完了の確認**：
Step 4完了後、以下を整理してユーザーに提示する：
- イベント一覧（時系列順）
- ペインポイント一覧
- 境界候補

---

## フェーズ2：叩き台生成 → 対話型精緻化（Step 5〜10）

Step 1〜4の成果をもとに、AIがStep 5〜10の要素を一括生成し、対話で精緻化する。

### 叩き台の一括生成

Step 1〜4の結果と、提供された事業コンテキストをもとに、以下を一括で生成する：

**Step 5：コマンドとアクター**
- 各イベントを引き起こすコマンド（操作）を特定する
- 各コマンドを実行するアクター（人間やシステム）を特定する

**Step 6：ポリシー**
- 「あるイベントが起きたら自動的に次のコマンドを発動する」ビジネスルールを特定する
- ポリシーには条件分岐を含めて記述する
- ポリシーはイベントハンドラやSaga/Process Managerとして実装される想定

**Step 7：読み取りモデル**
- アクターが判断を下すために参照するデータビューを特定する

**Step 8：外部システム**
- 対象領域の外にある連携先システムを特定する

**Step 9：集約**
- 関連するコマンドとイベントを、一貫性を保証する単位（集約）として整理する
- 各集約について以下を定義する：
  - 不変条件（常に満たすべきビジネスルール）
  - 含まれるコマンドとイベント
  - ライフサイクル（生成から終了までの状態遷移）

**Step 10：区切られた文脈（Bounded Context）**
- Step 4で特定した境界候補をもとに、集約をBounded Contextにグルーピングする
- 各Bounded Contextの責務を定義する
- コンテキスト間の依存関係を明示する

### 精緻化の対話

叩き台を提示した後、以下の観点でユーザーと精緻化する：

1. **コマンド・アクター・ポリシーの確認**
   - 「この操作は本当にこのアクターが行いますか？」
   - 「このポリシー（自動処理）は正しいですか？条件の抜けはないですか？」

2. **集約の境界の確認**（重点的に議論）
   - 「この集約の範囲は適切ですか？大きすぎる／小さすぎることはないですか？」
   - 「この集約の不変条件は正しいですか？他に常に守るべきルールはありますか？」
   - 「この2つの集約は、同時に整合性を保つ必要がありますか？」

3. **Bounded Contextの境界の確認**（重点的に議論）
   - 「この境界の引き方は妥当ですか？」
   - 「このコンテキスト間の依存関係は正しいですか？」
   - 「既存のシステム構造との整合性は取れていますか？」

---

## セッション完了

全ステップの精緻化が完了したら：

1. `references/output-format.md` に従い最終成果物markdownを生成する
2. ユーザーに最終成果物を提示し、最終確認を取る
3. ペインポイント・未解決事項を強調し、次のアクション（チームへの共有、ADR執筆など）を提案する
