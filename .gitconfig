# ==========================================
# Git Configuration Enhancements
# ==========================================
# NOTE: Add your personal [user] section separately!
# This file contains only the enhancement settings.

# ==========================================
# Core Settings
# ==========================================
[core]
	pager = delta

# ==========================================
# Delta Configuration (Beautiful Diffs)
# ==========================================
[interactive]
	diffFilter = delta --color-only

[delta]
	navigate = true
	side-by-side = true
	line-numbers = true
	# Disable syntax highlighting to prevent color rendering issues in lazygit/tcell
	syntax-theme = none
	plus-style = syntax "#2a3a2a"
	minus-style = syntax "#3a2a2a"

# ==========================================
# Merge & Rebase Settings
# ==========================================
[merge]
	conflictstyle = zdiff3

[rebase]
	autoStash = true
	autoSquash = true

# ==========================================
# Diff & Performance Optimization
# ==========================================
[diff]
	algorithm = histogram
	# Disable colorMoved to prevent color conflicts with delta in lazygit/terminal
	# (colorMoved colors override delta's plus-style/minus-style settings)
	colorMoved = no

[fetch]
	writeCommitGraph = true
	prune = true
	pruneTags = true

[pull]
	rebase = false

[push]
	autoSetupRemote = true

# ==========================================
# Git Aliases
# ==========================================
[alias]
	# fzf staging (like GitHub Desktop - multi-select with Tab, confirm with Enter)
	stf = "!git status -s -uall | fzf -m --marker '✔ ' --color 'marker:green:bold' --bind 'ctrl-a:select-all,ctrl-d:deselect-all' --preview 'file=$(echo {} | sed \"s/^...//\" | sed \"s/.* -> //\"); diff=$(git diff HEAD --color=always -- \"$file\" 2>/dev/null); if [ -n \"$diff\" ]; then echo \"$diff\" | delta --no-gitconfig --line-numbers --syntax-theme=Nord; else diff=$(git diff --cached --color=always -- \"$file\" 2>/dev/null); if [ -n \"$diff\" ]; then echo \"$diff\" | delta --no-gitconfig --line-numbers --syntax-theme=Nord; else bat --color=always \"$file\" 2>/dev/null; fi; fi' | sed 's/^...//' | sed 's/.* -> //' | xargs -I {} git add '{}'"

	# Switch branch with fzf
	swf = "!branch=$(git branch --all | grep -v '^\\*' | grep -v 'HEAD ->' | sed 's|^[[:space:]]*||' | sed 's|remotes/origin/||' | sort -u | fzf --preview 'git log --oneline --color=always {}') && [ -n \"$branch\" ] && git switch \"$branch\""

	# Beautiful log with graph
	logg = log --graph --all --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(auto)%d%C(reset)'

	# Fixup commit (step 1)
	fixup = "!f() { git commit --fixup \"${1:-HEAD}\"; }; f"

	# Squash fixup commits (step 2)
	squash = "!git rebase -i --autosquash $(git merge-base HEAD $(git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'))"

	# Safe force push (use instead of --force)
	pushf = push --force-with-lease

	# History fzf - GitHub Desktop History tab like experience
	# - ⬆ mark for unpushed commits
	# - Preview shows changed files + diff
	# - Enter to view full diff in less
	hf = "!f() { \
		unpushed=$(git log --format='%h' @{u}..HEAD 2>/dev/null); \
		git log --color=always \
			--format='%h %C(blue)%ar%C(reset) %s %C(dim)- %an%C(reset)%C(auto)%d' \
			$(git rev-parse --abbrev-ref HEAD) \
		| while IFS= read -r line; do \
			short_hash=$(echo \"$line\" | rg -o '^[a-f0-9]+'); \
			if echo \"$unpushed\" | rg -qF \"$short_hash\"; then \
				printf '⬆ %s\\n' \"$line\"; \
			else \
				printf '  %s\\n' \"$line\"; \
			fi; \
		done \
		| fzf --ansi --no-sort --reverse \
			--header=\"$(git log --oneline @{u}..HEAD 2>/dev/null | wc -l | tr -d ' ') commits ahead of origin\" \
			--preview 'hash=$(echo {} | rg -o \"[a-f0-9]{7,}\" | head -1); git show --stat --color=always $hash && echo && git show $hash --color=always | delta --no-gitconfig --line-numbers --syntax-theme=Nord' \
			--preview-window=right:60% \
			--bind 'enter:execute(hash=$(echo {} | rg -o \"[a-f0-9]{7,}\" | head -1); git show $hash --color=always | delta --no-gitconfig --line-numbers --syntax-theme=Nord | less -R)'; \
	}; f"

